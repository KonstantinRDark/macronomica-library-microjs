{"version":3,"sources":["../../src/utils/run-subscribers.js"],"names":["runSubscribers","microjs","subscribers","getPromise","Promise","resolve","reject","eachSeries","iterator","endCb","subscriber","callback","promise","then","catch","err","results"],"mappings":";;;;;kBAEwBA,c;;AAFxB;;;;;;AAEe,SAASA,cAAT,CAAwBC,OAAxB,EAAiCC,WAAjC,EAA8CC,UAA9C,EAA0D;AACvE,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KACjB,gBAAMC,UAAN,CAAiBL,WAAjB,EAA8BM,QAA9B,EAAwCC,MAAMJ,OAAN,EAAeC,MAAf,CAAxC,CADK,CAAP;;AAGA,WAASE,QAAT,CAAkBE,UAAlB,EAA8BC,QAA9B,EAAwC;AACtC,QAAIC,UAAUT,WAAWO,UAAX,CAAd;;AAEA,QAAI,CAACE,OAAD,IAAY,OAAOA,QAAQC,IAAf,KAAwB,UAAxC,EAAoD;AAClDD,gBAAUR,QAAQC,OAAR,CAAgBO,OAAhB,CAAV;AACD;;AAEDA,YAAQC,IAAR,CAAa,MAAMF,SAAS,IAAT,CAAnB,EACGG,KADH,CACSH,QADT;AAED;;AAED,WAASF,KAAT,CAAeJ,OAAf,EAAwBC,MAAxB,EAAgC;AAC9B,WAAO,CAACS,GAAD,EAAMC,OAAN,KAAkBD,MAAMT,OAAOS,GAAP,CAAN,GAAoBV,SAA7C;AACD;AACF","file":"run-subscribers.js","sourcesContent":["import async from 'async';\n\nexport default function runSubscribers(microjs, subscribers, getPromise) {\n  return new Promise((resolve, reject) =>\n    async.eachSeries(subscribers, iterator, endCb(resolve, reject)));\n\n  function iterator(subscriber, callback) {\n    let promise = getPromise(subscriber);\n\n    if (!promise || typeof promise.then !== 'function') {\n      promise = Promise.resolve(promise);\n    }\n\n    promise.then(() => callback(null))\n      .catch(callback);\n  }\n\n  function endCb(resolve, reject) {\n    return (err, results) => err ? reject(err) : resolve();\n  }\n}"]}