{"version":3,"sources":["../../src/utils/make-request.js"],"names":["TRANSPORT","type","trace","origin","clear","app","raw","appId","appName","log","transport","request","msg","req","id","name","Object","assign","time","hrtime","process","start","Date","now","updateDuration","act","seconds","nanoseconds","end","duration"],"mappings":";;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AAEA,MAAMA,YAAY;AAChBC,QAAQ,OADQ;AAEhBC,SAAQ,EAFQ;AAGhBC,UAAS,oBAAD,gBAA6B;AAHrB,CAAlB;;QAOEC,K,GAAAA,K;;kBAGa,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC3B,MAAI,sBAASA,GAAT,CAAJ,EAAmB;AACjBA,UAAM,sBAAOA,GAAP,CAAN;AACD;;AAH0B,aAYvBA,GAZuB;AAAA,QAOzBC,KAPyB,QAOzBA,KAPyB;AAAA,QAOlBC,OAPkB,QAOlBA,OAPkB;AAAA,QAOTC,GAPS,QAOTA,GAPS;AAAA,4BASzBC,SATyB;AAAA,QASzBA,SATyB,kCASbV,SATa;AAAA,0BAUzBW,OAVyB;;AAAA,QAUzBA,OAVyB,gCAUf,EAVe;AAAA,QAWtBC,GAXsB;;AAc3B,QAAMC,MAAM;AACV,QAAIN,KAAJ,GAAY;AAAE,aAAOF,IAAIS,EAAX;AAAe,KADnB;;AAGV,QAAIN,OAAJ,GAAc;AAAE,aAAOH,IAAIU,IAAX;AAAiB,KAHvB;;AAKV,QAAIN,GAAJ,GAAU;AAAE,aAAOJ,IAAII,GAAX;AAAgB;AALlB,GAAZ;;AAQA,SAAOO,OAAOC,MAAP,CAAcJ,GAAd;AACLH,aADK;AAELC;AACEG,UAAM;AADR,OAEKH,OAFL;AAGEO,YAAM;AACJC,gBAAQC,QAAQD,MAAR,EADJ;AAEJE,eAAQC,KAAKC,GAAL;AAFJ;AAHR;AAFK,KAUFX,GAVE;AAWLY,kBAXK;AAYLC,SAAK;AAAA,aAAapB,IAAIoB,GAAJ,CAAQ,YAAR,CAAb;AAAA;AAZA,KAAP;;AAeA,WAASD,cAAT,GAA0B;AAAA,0BACSJ,QAAQD,MAAR,CAAeN,IAAIF,OAAJ,CAAYO,IAAZ,CAAiBC,MAAhC,CADT;AAAA;;AAAA,UAChBO,OADgB;AAAA,UACPC,WADO;;AAExBd,QAAIF,OAAJ,CAAYO,IAAZ,CAAiBU,GAAjB,GAAuBN,KAAKC,GAAL,EAAvB;AACAV,QAAIF,OAAJ,CAAYO,IAAZ,CAAiBW,QAAjB,GAA4B,6BAAOH,UAAU,IAAX,GAAoBC,cAAc,IAAxC,EAA+C,CAAC,CAAhD,IAAqD,IAAjF;AACA,WAAOd,GAAP;AACD;AACF,C;;AAED,SAAST,KAAT,GAA8F;AAAA,iFAAJ,EAAI;;AAAA,MAA7EG,KAA6E,QAA7EA,KAA6E;AAAA,MAAtEC,OAAsE,QAAtEA,OAAsE;AAAA,MAA7DC,GAA6D,QAA7DA,GAA6D;AAAA,MAAxDe,cAAwD,QAAxDA,cAAwD;AAAA,MAAxCC,GAAwC,QAAxCA,GAAwC;AAAA,MAAnCf,SAAmC,QAAnCA,SAAmC;AAAA,MAAxBC,OAAwB,QAAxBA,OAAwB;AAAA,MAAZC,GAAY;;AAC5F,SAAOA,GAAP;AACD","file":"make-request.js","sourcesContent":["import isString from 'lodash.isstring';\nimport jsonic from 'jsonic';\nimport { version } from '../../package.json';\nimport genid from './genid';\nimport { round } from './mdn-decimal-adjust';\n\nconst TRANSPORT = {\n  type  : 'inner',\n  trace : [],\n  origin: `microjs-origin-v${ version }`\n};\n\nexport {\n  clear\n};\n\nexport default (app, raw) => {\n  if (isString(raw)) {\n    raw = jsonic(raw);\n  }\n  \n  const {\n    // Убираем гетеры если есть\n    appId, appName, log,\n    \n    transport = TRANSPORT,\n    request = {},\n    ...msg\n  } = raw;\n  \n  const req = {\n    get appId() { return app.id },\n  \n    get appName() { return app.name },\n  \n    get log() { return app.log },\n  };\n\n  return Object.assign(req, {\n    transport,\n    request: {\n      id  : genid(),\n      ...request,\n      time: {\n        hrtime: process.hrtime(),\n        start : Date.now()\n      }\n    },\n    ...msg,\n    updateDuration,\n    act: (...rest) => app.act(...rest)\n  });\n  \n  function updateDuration() {\n    const [ seconds, nanoseconds ] = process.hrtime(req.request.time.hrtime);\n    req.request.time.end = Date.now();\n    req.request.time.duration = round((seconds * 1000) + (nanoseconds * 1e-6), -3) + 'ms';\n    return req;\n  }\n};\n\nfunction clear({ appId, appName, log, updateDuration, act, transport, request, ...msg } = {}) {\n  return msg;\n}"]}