{"version":3,"sources":["../../src/utils/run-init-subscribers.js"],"names":["runInitSubscribers","microjs","initSubscribers","closeSubscribers","queue","count","map","push","p","subscriber","onClose","then","Promise","resolve","cb","catch","dfd","promise"],"mappings":";;;;;kBAGwBA,kB;;AAHxB;;;;AACA;;;;;;AAEe,SAASA,kBAAT,CAA4BC,OAA5B,EAAqCC,eAArC,EAAsDC,gBAAtD,EAAwE;AACrF,MAAMC,QAAQ,qBAAd;AACA,MAAIC,QAAQ,CAAZ;AACA;AACAH,kBAAgBI,GAAhB,CAAoB;AAAA,WAAcF,MAAMG,IAAN,CAAW,cAAM;AACjDF;AACA,UAAIG,IAAIC,WAAWR,OAAX,EAAoB,EAAES,gBAAF,EAApB,CAAR;;AAEA,UAAI,CAACF,CAAD,IAAM,OAAOA,EAAEG,IAAT,KAAkB,UAA5B,EAAwC;AACtCH,YAAII,QAAQC,OAAR,CAAgBL,CAAhB,CAAJ;AACD;;AAEAA,QAAEG,IAAF,CAAO;AAAA,eAAMG,GAAG,IAAH,CAAN;AAAA,OAAP,EACEC,KADF,CACQD,EADR;AAEF,KAViC,CAAd;AAAA,GAApB;;AAYA,SAAOE,IAAIC,OAAX;;AAEA,WAASP,OAAT,CAAiBI,EAAjB,EAAqB;AACnBX,qBAAiBI,IAAjB,CAAsBO,EAAtB;AACD;AACF","file":"run-init-subscribers.js","sourcesContent":["import Queue from 'queue3';\nimport defer from './defer';\n\nexport default function runInitSubscribers(microjs, initSubscribers, closeSubscribers) {\n  const queue = new Queue();\n  let count = 0;\n  // TODO дописать алгоритм последовательного запуска\n  initSubscribers.map(subscriber => queue.push(cb => {\n    count++;\n    let p = subscriber(microjs, { onClose });\n\n    if (!p || typeof p.then !== 'function') {\n      p = Promise.resolve(p);\n    }\n\n     p.then(() => cb(null))\n      .catch(cb);\n  }));\n\n  return dfd.promise;\n\n  function onClose(cb) {\n    closeSubscribers.push(cb);\n  }\n}"]}