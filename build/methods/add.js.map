{"version":3,"sources":["../../src/methods/add.js"],"names":["app","pin","cb","state","__add","subscribers","add","push","action","id","name","log","info","manager","callback"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAIeA,OAAO;AACpB;;;;;;AAMA,SAAO,CAACC,GAAD,EAAMC,EAAN,KAAa;AAClB,QAAIF,IAAIG,KAAJ,yBAAJ,EAA6B;AAC3B,aAAOC,OAAP;AACD;;AAEDJ,QAAIK,WAAJ,CAAgBC,GAAhB,CAAoBC,IAApB,CAAyBH,KAAzB;;AAEA,WAAOJ,GAAP;;AAEA,aAASI,KAAT,GAAiB;AACf,YAAMI,SAAS;AACbC,YAAM,sBADO;AAEbC,cAAMR,GAAGQ,IAAH,IAAW;AAFJ,OAAf;AAIAV,UAAIW,GAAJ,CAAQC,IAAR,CAAc,4BAAd,EAA2C,EAAEX,GAAF,EAAOO,MAAP,EAA3C;;AAEAR,UAAIa,OAAJ,CAAYP,GAAZ,CAAgB,sBAASL,GAAT,IAAgB,sBAAOA,GAAP,CAAhB,GAA8BA,GAA9C,EAAmD,EAAEA,GAAF,EAAOO,MAAP,EAAeM,UAAUZ,EAAzB,EAAnD;;AAEA,aAAOF,GAAP;AACD;AACF,GApBD;AAqBD,C","file":"add.js","sourcesContent":["import isString from 'lodash.isstring';\nimport jsonic from 'jsonic';\nimport genid from './../utils/genid';\nimport { STATE_RUN } from './../constants';\n\n/**\n * @param {app} app\n * @returns {function}\n */\nexport default app => {\n  /**\n   * @namespace app.add\n   * @param {string|object} pin\n   * @param {function} cb\n   * @returns {app}\n   */\n  return (pin, cb) => {\n    if (app.state === STATE_RUN) {\n      return __add();\n    }\n\n    app.subscribers.add.push(__add);\n\n    return app;\n\n    function __add() {\n      const action = {\n        id  : genid(),\n        name: cb.name || ''\n      };\n      app.log.info(`Добавление нового маршрута`, { pin, action });\n\n      app.manager.add(isString(pin) ? jsonic(pin) : pin, { pin, action, callback: cb });\n\n      return app;\n    }\n  };\n};"]}