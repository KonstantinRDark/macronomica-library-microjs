{"version":3,"sources":["../../src/methods/add.js"],"names":["app","pin","cb","state","__add","subscribers","add","push","end","del","action","id","name","log","trace","manager","callback"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAIeA,OAAO;AACpB;;;;;;AAMA,SAAO,CAACC,GAAD,EAAMC,EAAN,KAAa;AAClB,QAAIF,IAAIG,KAAJ,yBAAJ,EAA6B;AAC3B,aAAOC,OAAP;AACD;;AAEDJ,QAAIK,WAAJ,CAAgBC,GAAhB,CAAoBC,IAApB,CAAyBH,KAAzB;AACAJ,QAAIK,WAAJ,CAAgBG,GAAhB,CAAoBD,IAApB,CAAyB,MAAMP,IAAIS,GAAJ,CAAQR,GAAR,CAA/B;;AAEA,WAAOD,GAAP;;AAEA,aAASI,KAAT,GAAiB;AACf,YAAMM,SAAS;AACbC,YAAM,sBADO;AAEbC,cAAMV,GAAGU;AAFI,OAAf;AAIA;;AAEAZ,UAAIa,GAAJ,CAAQC,KAAR,CAAe,sBAAsBJ,OAAOE,IAAP,IAAeF,OAAOC,EAAI,EAA/D,EAAkE,EAAEV,GAAF,EAAOS,MAAP,EAAlE;;AAEAV,UAAIe,OAAJ,CAAYT,GAAZ,CAAgB,sBAASL,GAAT,IAAgB,sBAAOA,GAAP,CAAhB,GAA8BA,GAA9C,EAAmD,EAAEA,GAAF,EAAOS,MAAP,EAAeM,UAAUd,EAAzB,EAAnD;;AAEA,aAAOF,GAAP;AACD;AACF,GAvBD;AAwBD,C","file":"add.js","sourcesContent":["import isString from 'lodash.isstring';\nimport jsonic from 'jsonic';\nimport genid from './../utils/genid';\nimport { STATE_RUN } from './../constants';\n\n/**\n * @param {app} app\n * @returns {function}\n */\nexport default app => {\n  /**\n   * @namespace app.add\n   * @param {string|object} pin\n   * @param {function} cb\n   * @returns {app}\n   */\n  return (pin, cb) => {\n    if (app.state === STATE_RUN) {\n      return __add();\n    }\n\n    app.subscribers.add.push(__add);\n    app.subscribers.end.push(() => app.del(pin));\n\n    return app;\n\n    function __add() {\n      const action = {\n        id  : genid(),\n        name: cb.name\n      };\n      // let level = pin.role === 'plugin' || ('private' in pin && pin.private === true) ? 'trace' : 'info';\n\n      app.log.trace(`microjs.common.add.${ action.name || action.id }`, { pin, action });\n\n      app.manager.add(isString(pin) ? jsonic(pin) : pin, { pin, action, callback: cb });\n\n      return app;\n    }\n  };\n};"]}