{"version":3,"sources":["../../src/methods/act.js"],"names":["app","pin","cb","dfd","msg","route","manager","find","log","trace","reject","promise","callback","then","Promise","resolve","catch","err","error"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA;;;;kBAIeA,OAAO;AACpB;;;;;;AAMA,SAAO,CAACC,GAAD,EAAMC,EAAN,KAAa;AAClB,UAAMC,MAAM,qBAAMD,EAAN,CAAZ;AACA,UAAME,MAAM,sBAASH,GAAT,IAAgB,sBAAOA,GAAP,CAAhB,GAA8BA,GAA1C;AACA,UAAMI,QAAQL,IAAIM,OAAJ,CAAYC,IAAZ,CAAiBH,GAAjB,CAAd;;AAEA,QAAI,CAACC,KAAL,EAAY;AACVL,UAAIQ,GAAJ,CAAQC,KAAR,CAAe,iCAAf,EAAiDR,GAAjD;AACA,aAAOE,IAAIO,MAAJ,CAAY,iCAAZ,CAAP;AACD;;AAED,QAAI;AACF,UAAIC,UAAUN,MAAMO,QAAN,CAAeR,GAAf,EAAoBC,KAApB,CAAd;;AAEA,UAAI,CAACM,OAAD,IAAY,OAAOA,QAAQE,IAAf,KAAwB,UAAxC,EAAoD;AAClDF,kBAAUG,QAAQC,OAAR,CAAgBJ,OAAhB,CAAV;AACD;;AAEDA,cAAQE,IAAR,CAAaV,IAAIY,OAAjB,EAA0BC,KAA1B,CAAgCb,IAAIO,MAApC;;AAEA,aAAOP,IAAIQ,OAAX;AACD,KAVD,CAUE,OAAOM,GAAP,EAAY;AACZjB,UAAIQ,GAAJ,CAAQU,KAAR,CAAe,4BAAf,EAA4CjB,GAA5C,EAAiDgB,GAAjD;AACA,aAAOd,IAAIO,MAAJ,CAAWO,GAAX,CAAP;AACD;AACF,GAxBD;AAyBD,C","file":"act.js","sourcesContent":["import isString from 'lodash.isstring';\nimport jsonic from 'jsonic';\nimport defer from './../utils/defer';\n\n/**\n * @param {app} app\n * @returns {function:app}\n */\nexport default app => {\n  /**\n   * @namespace app.act\n   * @param {string|object} pin\n   * @param {function} [cb]\n   * @returns {app}\n   */\n  return (pin, cb) => {\n    const dfd = defer(cb);\n    const msg = isString(pin) ? jsonic(pin) : pin;\n    const route = app.manager.find(msg);\n\n    if (!route) {\n      app.log.trace(`Вызов не существующего маршрута`, pin);\n      return dfd.reject(`Вызов не существующего маршрута`);\n    }\n\n    try {\n      let promise = route.callback(msg, route);\n\n      if (!promise || typeof promise.then !== 'function') {\n        promise = Promise.resolve(promise);\n      }\n\n      promise.then(dfd.resolve).catch(dfd.reject);\n\n      return dfd.promise;\n    } catch (err) {\n      app.log.error(`Ошибка при вызове маршрута`, pin, err);\n      return dfd.reject(err);\n    }\n  };\n}"]}