{"version":3,"sources":["../../src/methods/act.js"],"names":["pin","cb","dfd","msg","route","app","manager","find","cmd","log","trace","reject","promise","callback","then","Promise","resolve","catch","err","error"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA;;;;kBAIe,eAAO;AACpB;;;;;;AAMA,SAAO,UAACA,GAAD,EAAMC,EAAN,EAAa;AAClB,QAAMC,MAAM,qBAAMD,EAAN,CAAZ;AACA,QAAME,MAAM,sBAASH,GAAT,IAAgB,sBAAOA,GAAP,CAAhB,GAA8BA,GAA1C;AACA,QAAMI,QAAQC,IAAIC,OAAJ,CAAYC,IAAZ,CAAiBJ,GAAjB,CAAd;;AAEA,QAAI,CAACC,KAAL,EAAY;AACV,UAAID,IAAIK,GAAJ,KAAY,QAAhB,EAA0B;AACxBH,YAAII,GAAJ,CAAQC,KAAR,gLAAiDV,GAAjD;AACD;AACD,aAAOE,IAAIS,MAAJ,+KAAP;AACD;;AAED,QAAI;AACF,UAAIC,UAAUR,MAAMS,QAAN,CAAeV,GAAf,EAAoBC,KAApB,CAAd;;AAEA,UAAI,CAACQ,OAAD,IAAY,OAAOA,QAAQE,IAAf,KAAwB,UAAxC,EAAoD;AAClDF,kBAAUG,QAAQC,OAAR,CAAgBJ,OAAhB,CAAV;AACD;;AAEDA,cAAQE,IAAR,CAAaZ,IAAIc,OAAjB,EAA0BC,KAA1B,CAAgCf,IAAIS,MAApC;;AAEA,aAAOT,IAAIU,OAAX;AACD,KAVD,CAUE,OAAOM,GAAP,EAAY;AACZb,UAAII,GAAJ,CAAQU,KAAR,kJAA4CnB,GAA5C,EAAiDkB,GAAjD;AACA,aAAOhB,IAAIS,MAAJ,CAAWO,GAAX,CAAP;AACD;AACF,GA1BD;AA2BD,C","file":"act.js","sourcesContent":["import isString from 'lodash.isstring';\nimport jsonic from 'jsonic';\nimport defer from './../utils/defer';\n\n/**\n * @param {app} app\n * @returns {function:app}\n */\nexport default app => {\n  /**\n   * @namespace app.act\n   * @param {string|object} pin\n   * @param {function} [cb]\n   * @returns {app}\n   */\n  return (pin, cb) => {\n    const dfd = defer(cb);\n    const msg = isString(pin) ? jsonic(pin) : pin;\n    const route = app.manager.find(msg);\n\n    if (!route) {\n      if (msg.cmd !== 'logger') {\n        app.log.trace(`Вызов не существующего маршрута`, pin);\n      }\n      return dfd.reject(`Вызов не существующего маршрута`);\n    }\n\n    try {\n      let promise = route.callback(msg, route);\n\n      if (!promise || typeof promise.then !== 'function') {\n        promise = Promise.resolve(promise);\n      }\n\n      promise.then(dfd.resolve).catch(dfd.reject);\n\n      return dfd.promise;\n    } catch (err) {\n      app.log.error(`Ошибка при вызове маршрута`, pin, err);\n      return dfd.reject(err);\n    }\n  };\n}"]}