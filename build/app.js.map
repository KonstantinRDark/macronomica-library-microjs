{"version":3,"sources":["../src/app.js"],"names":["Microjs","constructor","settings","id","state","manager","gex","subscribers","run","add","end","time","started","Date","now","running","log","use","del","api","act","maxListeners","defaultMaxListeners","setMaxListeners","on","app","info","join"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;;AAKe,MAAMA,OAAN,0BAAmC;;AA4BhD;;;;;;;AAZA;;;;AAiCAC,gBAA2B;AAAA,QAAfC,QAAe,uEAAJ,EAAI;;AACzB;AADyB,SAnC3BC,EAmC2B,GAnCtB,sBAmCsB;AAAA,SA7B3BC,KA6B2B;AAAA,SAvB3BC,OAuB2B,GAvBjB,sBAAO,EAAEC,KAAK,IAAP,EAAP,CAuBiB;AAAA,SAhB3BC,WAgB2B,GAhBb;AACZC,WAAK,EADO,EACE;AACdC,WAAK,EAFO,EAEE;AACdC,WAAK,EAHO,CAGE;AAHF,KAgBa;AAAA,SAL3BC,IAK2B,GALpB;AACLC,eAASC,KAAKC,GAAL,EADJ;AAELC,eAAS;AAFJ,KAKoB;AAAA,SA2B3BC,GA3B2B,GA2BrB,mBAAI,IAAJ,CA3BqB;AAAA,SA4B3BC,GA5B2B,GA4BrB,mBAAI,IAAJ,CA5BqB;AAAA,SA6B3BR,GA7B2B,GA6BrB,mBAAI,IAAJ,CA7BqB;AAAA,SA8B3BS,GA9B2B,GA8BrB,mBAAI,IAAJ,CA9BqB;AAAA,SA+B3BC,GA/B2B,GA+BrB,mBAAI,IAAJ,CA/BqB;AAAA,SAgC3BC,GAhC2B,GAgCrB,mBAAI,IAAJ,CAhCqB;AAAA,SAiC3BV,GAjC2B,GAiCrB,mBAAI,IAAJ,CAjCqB;AAAA,SAkC3BF,GAlC2B,GAkCrB,mBAAI,IAAJ,CAlCqB;AAAA,UAEjBL,EAFiB,GAEuCD,QAFvC,CAEjBC,EAFiB;AAAA,gCAEuCD,QAFvC,CAEbmB,YAFa;AAAA,UAEbA,YAFa,yCAEE,iBAAaC,mBAFf;;;AAIzB,QAAI,CAAC,CAACnB,EAAN,EAAU;AACR,WAAKA,EAAL,GAAUA,EAAV;AACD;;AAED,SAAKD,QAAL,GAAgBA,QAAhB;AACA,SAAKqB,eAAL,CAAqBF,YAArB;;AAEA,SAAKG,EAAL,CAAQ,SAAR,EAAmBC,OAAO;AACxBA,UAAIrB,KAAJ;AACAqB,UAAId,IAAJ,CAASI,OAAT,GAAmBF,KAAKC,GAAL,EAAnB;AACAW,UAAIT,GAAJ,CAAQU,IAAR,CAAa,CACX,IADW,EAEX,gGAFW,EAGX,iBAHW,EAIX,+FAJW,EAKX,mBAAmBD,IAAItB,EALZ,EAMV,kBAAiB,6BAAcsB,IAAId,IAAJ,CAASC,OAAvB,CAAiC,GANxC,EAOV,kBAAiB,6BAAca,IAAId,IAAJ,CAASI,OAAvB,CAAiC,GAPxC,EAQX,gGARW,EASXY,IATW,CASN,IATM,CAAb;AAUD,KAbD;AAcD;;AAnCD;;;;;;;AAjBA;;;;;AArBA;;;;AAIA;;;;;AAKA;;;;AAVgD;kBAA7B3B,O","file":"app.js","sourcesContent":["import EventEmitter from 'events';\nimport Patrun from 'patrun';\n\nimport genid from './utils/genid';\nimport dateIsoString from './utils/date-iso-string';\n\nimport log from './methods/log';\nimport use from './methods/use';\nimport add from './methods/add';\nimport del from './methods/del';\nimport act from './methods/act';\nimport api from './methods/api';\nimport end from './methods/end';\nimport run from './methods/run';\nimport { STATE_START, STATE_RUN } from './constants';\n\n/**\n * @namespace app\n * @class Microjs\n * @augments EventEmitter\n */\nexport default class Microjs extends EventEmitter {\n  /**\n   * @namespace app\n   * @memberof app.on\n   */\n  /**\n   * @namespace app\n   * @memberof app.emit\n   */\n\n  /**\n   * @namespace app.id\n   * @type {string}\n   */\n  id = genid();\n\n  /**\n   * @namespace app.state\n   * @type {string}\n   */\n  state = STATE_START;\n\n  /**\n   * @namespace app.manager\n   * @type {object}\n   */\n  manager = Patrun({ gex: true });\n\n  /**\n   * Список подписчиков\n   * @namespace app.subscribers\n   * @type {{ run: Array<function>, add: Array<function>, end: Array<function> }}\n   */\n  subscribers = {\n    run: [],      // подписчики для этапа запуска работы\n    add: [],      // подписчики для этапа регистрации действий\n    end: []       // подписчики для этапа завершения работы\n  };\n\n  /**\n   * Метрики времени\n   * @namespace app.time\n   * @type {{ started: number, running: ?number }}\n   */\n  time = {\n    started: Date.now(),\n    running: null\n  };\n\n  constructor(settings = {}) {\n    super();\n    const { id, maxListeners = EventEmitter.defaultMaxListeners } = settings;\n\n    if (!!id) {\n      this.id = id;\n    }\n\n    this.settings = settings;\n    this.setMaxListeners(maxListeners);\n\n    this.on('running', app => {\n      app.state = STATE_RUN;\n      app.time.running = Date.now();\n      app.log.info([\n        '\\n',\n        '##############################################################################################',\n        '# Micro started',\n        '# ===========================================================================================',\n        '# Instance  : ' + app.id,\n        `# Started At: ${ dateIsoString(app.time.started) }`,\n        `# Running At: ${ dateIsoString(app.time.running) }`,\n        '##############################################################################################',\n      ].join('\\n'));\n    });\n  }\n\n  log = log(this);\n  use = use(this);\n  add = add(this);\n  del = del(this);\n  api = api(this);\n  act = act(this);\n  end = end(this);\n  run = run(this);\n}"]}