{"version":3,"sources":["../../../src/plugins/log-winston/index.js"],"names":["level","settings","micro","onClose","plugin","id","logger","Logger","log","levels","LEVELS","has","get","clientOpts","loggerSettings","add","transports","Elasticsearch","Console","label","emit","on","message","payload"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;;;;;kBAEe,YAAiC;AAAA,iFAAP,EAAO;;AAAA,MAA9BA,KAA8B,QAA9BA,KAA8B;AAAA,MAApBC,QAAoB;;AAC9C,SAAO,CAACC,KAAD,YAAwB;AAAA,QAAdC,OAAc,SAAdA,OAAc;;AAC7B,UAAMC,SAAS,EAAEC,IAAI,sBAAN,EAAf;;AAEA,QAAIC,SAAS,IAAK,kBAAQC,MAAb;AACXP,aAAQA,SAASE,MAAMM,GAAN,CAAUR,KADhB;AAEXS,cAAQP,MAAMM,GAAN,CAAUE;AAFP,OAGRT,QAHQ,EAAb;;AAMA,QAAI,iBAAOU,GAAP,CAAW,+BAAX,CAAJ,EAAiD;AAAA,wBACF,iBAAOC,GAAP,CAAW,+BAAX,CADE;AAAA,8CACzCC,UADyC;;AAAA,UACzCA,UADyC,yCAC5B,EAD4B;AAAA,UACrBC,cADqB;;AAG/CR,aAAOS,GAAP,CAAW,kBAAQC,UAAR,CAAmBC,aAA9B,eACKH,cADL;AAEED,iCACKA,UADL;AAFF;AAMD,KATD,MASO;AACLP,aAAOS,GAAP,CAAW,kBAAQC,UAAR,CAAmBE,OAA9B,EAAwC;AACtCC,eAAOjB,MAAMG;AADyB,OAAxC;AAGD;;AAEDH,UAAMkB,IAAN,CAAW,mBAAX;AACAlB,UAAMmB,EAAN,CAAS,KAAT,EAAgB;AAAA,UAAGrB,KAAH,SAAGA,KAAH;AAAA,UAAUsB,OAAV,SAAUA,OAAV;AAAA,UAAmBC,OAAnB,SAAmBA,OAAnB;AAAA,aAAiCjB,OAAQN,KAAR,EAAgBsB,OAAhB,EAAyBC,OAAzB,CAAjC;AAAA,KAAhB;;AAEA,WAAOnB,MAAP;AACD,GA5BD;AA6BD,C","file":"index.js","sourcesContent":["import config from 'config';\nimport winston from 'winston';\nimport 'winston-elasticsearch';\nimport genid from './../../utils/genid';\n\nexport default ({ level, ...settings } = {}) => {\n  return (micro, { onClose }) => {\n    const plugin = { id: genid() };\n\n    let logger = new (winston.Logger)({\n      level : level || micro.log.level,\n      levels: micro.log.LEVELS,\n      ...settings\n    });\n\n    if (config.has('plugins.winston-elasticsearch')) {\n      let { clientOpts = {}, ...loggerSettings } = config.get('plugins.winston-elasticsearch');\n\n      logger.add(winston.transports.Elasticsearch, {\n        ...loggerSettings,\n        clientOpts: {\n          ...clientOpts\n        }\n      });\n    } else {\n      logger.add(winston.transports.Console, ({\n        label: micro.id\n      }));\n    }\n\n    micro.emit('plugin.logger.use');\n    micro.on('log', ({ level, message, payload }) => logger[ level ](message, payload));\n\n    return plugin;\n  }\n};"]}