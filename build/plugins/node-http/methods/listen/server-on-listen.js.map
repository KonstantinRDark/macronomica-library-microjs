{"version":3,"sources":["../../../../../src/plugins/node-http/methods/listen/server-on-listen.js"],"names":["serverOnListen","ERROR_TYPE","ServerListenInternalError","message","join","EOL","type","server","app","settings","meta","plugin","host","port","resolve","reject","listen","err","error","log","info"],"mappings":";;;;;;;;;;kBAYwBA,c;;AAZxB;;;;AACA;;;;;;AACA,MAAMC,aAAa,wBAAnB;;AAEA,MAAMC,4BAA4B,uBAAa;AAC7CC,WAAS,CACP,4CADO,EAEP,wBAFO,EAGPC,IAHO,CAGF,aAAGC,GAHD,CADoC;AAK7CC,QAAO,GAAGL,UAAY;AALuB,CAAb,CAAlC;;AAQe,SAASD,cAAT,CAAwBO,MAAxB,EAAgCC,GAAhC,EAAqCC,QAArC,EAA+CC,IAA/C,EAAqD;AAAA,qBAChCA,IADgC,CAC1DC,MAD0D;AAAA,QACjDC,IADiD,gBACjDA,IADiD;AAAA,QAC3CC,IAD2C,gBAC3CA,IAD2C;;;AAGlE,SAAO,sBAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCR,WAAOS,MAAP,CAAcH,IAAd,EAAoBD,IAApB,EAA2BK,GAAD,IAAS;;AAEjC,UAAIA,GAAJ,EAAS;AACP,YAAIC,QAAQhB,0BAA0Be,GAA1B,CAAZ;AACAT,YAAIW,GAAJ,CAAQD,KAAR,CAAcA,MAAMf,OAApB,EAA6BO,IAA7B;AACA,eAAOK,OAAOG,KAAP,CAAP;AACD;;AAEDV,UAAIW,GAAJ,CAAQC,IAAR,CAAc,kCAAkCR,IAAM,SAASC,IAAM,GAArE,EAAyE;AACvEF,gBAAQ,EAAEC,IAAF,EAAQC,IAAR;AAD+D,OAAzE;AAGAC;AACD,KAZD;AAaD,GAdM,CAAP;AAeD","file":"server-on-listen.js","sourcesContent":["import os from 'os';\nimport WrappedError from 'error/wrapped';\nconst ERROR_TYPE = 'micro.plugin.http-node';\n\nconst ServerListenInternalError = WrappedError({\n  message: [\n    '{name} - Внутренняя ошибка запуска сервера',\n    '{name} - {origMessage}',\n  ].join(os.EOL),\n  type: `${ ERROR_TYPE }.server.listen.internal`\n});\n\nexport default function serverOnListen(server, app, settings, meta) {\n  const { plugin:{ host, port } } = meta;\n\n  return new Promise((resolve, reject) => {\n    server.listen(port, host, (err) => {\n\n      if (err) {\n        let error = ServerListenInternalError(err);\n        app.log.error(error.message, meta);\n        return reject(error);\n      }\n\n      app.log.info(`Запущен Node Http сервер (host=${ host },port=${ port })`, {\n        plugin: { host, port }\n      });\n      resolve();\n    });\n  });\n};"]}