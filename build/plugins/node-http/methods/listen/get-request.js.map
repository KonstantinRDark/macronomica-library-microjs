{"version":3,"sources":["../../../../../src/plugins/node-http/methods/listen/get-request.js"],"names":["getRequest","type","app","req","pin","request","transport","getTransport","headers","verify","origin","method","time","Date","now","other","trace","name"],"mappings":";;;;;;;;;;;;;;;;;;kBAWwBA,U;;AAXxB;;;;AACA;;;;AAEA;;;;AAMA,MAAMC,OAAO,MAAb;;AAEe,SAASD,UAAT,CAAoBE,GAApB,EAAyBC,GAAzB,EAA8BC,GAA9B,EAAmC;AAChD,QAAMC,UAAU,2BAAYH,GAAZ;AACdI,eAAWC,aAAaL,GAAb,EAAkBC,GAAlB;AADG,KAEXC,GAFW,EAAhB;;AAKA,MAAI,oCAAyBD,IAAIK,OAAjC,EAA0C;AACxCH,YAAQA,OAAR,8BACKA,QAAQA,OADb,EAEK,uBAAII,MAAJ,CAAWN,IAAIK,OAAJ,kCAAX,4BAAgEH,OAFrE;AAID;;AAED,SAAOA,OAAP;AACD;;AAED,SAASE,YAAT,CAAsBL,GAAtB,EAA2BC,GAA3B,EAAgC;AAC9B,QAAMG,YAAY;AAChBL,QADgB;AAEhBS,YAAQP,IAAIK,OAAJ,CAAa,YAAb,CAFQ;AAGhBG,YAAQR,IAAIQ,MAHI;AAIhBC,UAAQC,KAAKC,GAAL;AAJQ,GAAlB;;AAOA,MAAI,sCAA2BX,IAAIK,OAAnC,EAA4C;AAAA,gCACjB,uBAAIC,MAAJ,CAAWN,IAAIK,OAAJ,oCAAX,4BAAkEF,SADjD;;AAAA,QACpCL,IADoC,yBACpCA,IADoC;AAAA,QAC3Bc,KAD2B;;AAE1C,0BAAcT,SAAd,EAAyBS,KAAzB;AACD;;AAEDT,YAAUU,KAAV,GAAkB,CAChB,IAAIV,UAAUU,KAAV,IAAmB,EAAvB,CADgB,EAEhBd,IAAIe,IAFY,CAAlB;;AAKA,SAAOX,SAAP;AACD","file":"get-request.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport makeRequest from './../../../../utils/make-request';\n\nimport {\n  SERVER_SECRET,\n  SERVER_TRANSPORT_HEADER,\n  SERVER_REQUEST_HEADER,\n} from './../../constants';\n\nconst type = 'http';\n\nexport default function getRequest(app, req, pin) {\n  const request = makeRequest(app, {\n    transport: getTransport(app, req),\n    ...pin\n  });\n\n  if (SERVER_REQUEST_HEADER in req.headers) {\n    request.request = {\n      ...request.request,\n      ...jwt.verify(req.headers[ SERVER_REQUEST_HEADER ], SERVER_SECRET).request\n    };\n  }\n\n  return request;\n}\n\nfunction getTransport(app, req) {\n  const transport = {\n    type,\n    origin: req.headers[ 'user-agent' ],\n    method: req.method,\n    time  : Date.now()\n  };\n\n  if (SERVER_TRANSPORT_HEADER in req.headers) {\n    let { type, ...other } = jwt.verify(req.headers[ SERVER_TRANSPORT_HEADER ], SERVER_SECRET).transport;\n    Object.assign(transport, other);\n  }\n\n  transport.trace = [\n    ...(transport.trace || []),\n    app.name\n  ];\n\n  return transport;\n}"]}