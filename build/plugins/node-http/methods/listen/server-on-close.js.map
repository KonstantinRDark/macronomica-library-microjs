{"version":3,"sources":["../../../../../src/plugins/node-http/methods/listen/server-on-close.js"],"names":["serverOnClose","ERROR_TYPE","ServerCloseInternalError","message","join","EOL","type","server","app","settings","meta","plugin","host","port","resolve","reject","close","err","error","log","info"],"mappings":";;;;;;;;;;kBAYwBA,a;;AAZxB;;;;AACA;;;;;;AACA,MAAMC,aAAa,wBAAnB;;AAEA,MAAMC,2BAA2B,uBAAa;AAC5CC,WAAS,CACP,8CADO,EAEP,wBAFO,EAGPC,IAHO,CAGF,aAAGC,GAHD,CADmC;AAK5CC,QAAO,GAAGL,UAAY;AALsB,CAAb,CAAjC;;AAQe,SAASD,aAAT,CAAuBO,MAAvB,EAA+BC,GAA/B,EAAoCC,QAApC,EAA8CC,IAA9C,EAAoD;AAAA,qBAC/BA,IAD+B,CACzDC,MADyD;AAAA,QAChDC,IADgD,gBAChDA,IADgD;AAAA,QAC1CC,IAD0C,gBAC1CA,IAD0C;;;AAGjE,SAAO,MAAM,sBAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC5CR,WAAOS,KAAP,CAAcC,GAAD,IAAS;AACpB,UAAIA,GAAJ,EAAS;AACP,YAAIC,QAAQhB,yBAAyBe,GAAzB,CAAZ;AACAT,YAAIW,GAAJ,CAAQD,KAAR,CAAcA,MAAMf,OAApB,EAA6BO,IAA7B;AACA,eAAOK,OAAOG,KAAP,CAAP;AACD;;AAEDV,UAAIW,GAAJ,CAAQC,IAAR,CAAc,qCAAqCR,IAAM,SAASC,IAAM,GAAxE,EAA4EH,IAA5E;AACAI;AACD,KATD;AAUD,GAXY,CAAb;AAYD","file":"server-on-close.js","sourcesContent":["import os from 'os';\nimport WrappedError from 'error/wrapped';\nconst ERROR_TYPE = 'micro.plugin.http-node';\n\nconst ServerCloseInternalError = WrappedError({\n  message: [\n    '{name} - Внутренняя ошибка остановки сервера',\n    '{name} - {origMessage}',\n  ].join(os.EOL),\n  type: `${ ERROR_TYPE }.server.close.internal`\n});\n\nexport default function serverOnClose(server, app, settings, meta) {\n  const { plugin:{ host, port } } = meta;\n\n  return () => new Promise((resolve, reject) => {\n    server.close((err) => {\n      if (err) {\n        let error = ServerCloseInternalError(err);\n        app.log.error(error.message, meta);\n        return reject(error);\n      }\n\n      app.log.info(`Остановлен Node Http сервер (host=${ host },port=${ port })`, meta);\n      resolve();\n    });\n  });\n}"]}